<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Results - Synapse</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="dashboard.html"><h1>üß† Synapse</h1></a>
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="btn btn-outline">Dashboard</a>
                <button onclick="logout()" class="btn btn-outline">Logout</button>
            </div>
        </div>
    </nav>

    <div class="results-container">
        <div class="container">
            <h1 class="page-title">Your Comprehensive Mental Health Report</h1>
            
            <div id="resultsContent">
                <p class="loading">Loading your results...</p>
            </div>
            
            <div class="action-buttons">
                <button onclick="window.print()" class="btn btn-primary">Print Report</button>
                <a href="dashboard.html" class="btn btn-outline">Back to Dashboard</a>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        checkAuthRedirect();
        
        async function loadResults() {
            try {
                const response = await fetch('result');
                const data = await response.json();
                
                if (data.success && data.result) {
                    displayResults(data.result);
                } else {
                    document.getElementById('resultsContent').innerHTML = 
                        '<p class="error">No results found. Please complete all tests first.</p>';
                }
            } catch (error) {
                document.getElementById('resultsContent').innerHTML = 
                    '<p class="error">Error loading results. Please try again.</p>';
            }
        }
        
        function displayResults(result) {
            const container = document.getElementById('resultsContent');
            
            const html = `
                <div class="result-section">
                    <h2>Test Scores Summary</h2>
                    <div class="scores-grid">
                        <div class="score-card">
                            <h3>Depression</h3>
                            <div class="score-value">${result.depressionScore}</div>
                            <div class="score-badge ${getLevelClass(result.depressionLevel)}">
                                ${result.depressionLevel}
                            </div>
                        </div>
                        
                        <div class="score-card">
                            <h3>Anxiety</h3>
                            <div class="score-value">${result.anxietyScore}</div>
                            <div class="score-badge ${getLevelClass(result.anxietyLevel)}">
                                ${result.anxietyLevel}
                            </div>
                        </div>
                        
                        <div class="score-card">
                            <h3>Stress</h3>
                            <div class="score-value">${result.stressScore}</div>
                            <div class="score-badge ${getLevelClass(result.stressLevel)}">
                                ${result.stressLevel}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="result-section">
                    <h2>Personality Profile (Big Five Traits)</h2>
                    <div class="personality-grid">
                        <div class="trait-bar">
                            <div class="trait-label">
                                <span>Openness</span>
                                <span>${result.opennessScore.toFixed(1)}/5.0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(result.opennessScore / 5) * 100}%"></div>
                            </div>
                        </div>
                        
                        <div class="trait-bar">
                            <div class="trait-label">
                                <span>Conscientiousness</span>
                                <span>${result.conscientiousnessScore.toFixed(1)}/5.0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(result.conscientiousnessScore / 5) * 100}%"></div>
                            </div>
                        </div>
                        
                        <div class="trait-bar">
                            <div class="trait-label">
                                <span>Extraversion</span>
                                <span>${result.extraversionScore.toFixed(1)}/5.0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(result.extraversionScore / 5) * 100}%"></div>
                            </div>
                        </div>
                        
                        <div class="trait-bar">
                            <div class="trait-label">
                                <span>Agreeableness</span>
                                <span>${result.agreeablenessScore.toFixed(1)}/5.0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(result.agreeablenessScore / 5) * 100}%"></div>
                            </div>
                        </div>
                        
                        <div class="trait-bar">
                            <div class="trait-label">
                                <span>Neuroticism</span>
                                <span>${result.neuroticismScore.toFixed(1)}/5.0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${(result.neuroticismScore / 5) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="result-section">
                    <h2>Overall Assessment</h2>
                    <div class="assessment-text">
                        ${formatText(result.overallAssessment)}
                    </div>
                </div>
                
                <div class="result-section">
                    <h2>Personalized Recommendations</h2>
                    <div class="recommendations-text">
                        ${formatText(result.recommendations)}
                    </div>
                </div>
                
                <div class="result-section disclaimer-section">
                    <h3>‚ö†Ô∏è Important Disclaimer</h3>
                    <p>This assessment is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. If you are experiencing severe symptoms, please consult a licensed mental health professional immediately.</p>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function getLevelClass(level) {
            if (!level) return '';
            const lowerLevel = level.toLowerCase();
            if (lowerLevel.includes('minimal') || lowerLevel.includes('low')) return 'level-low';
            if (lowerLevel.includes('mild') || lowerLevel.includes('moderate')) return 'level-moderate';
            return 'level-high';
        }
        
        function formatText(text) {
            if (!text) return '';
            return text.replace(/\n/g, '<br>');
        }
        
        function logout() {
            fetch('logout', { method: 'POST' })
                .then(() => window.location.href = 'index.html');
        }
        
        // Initialize
        loadResults();
    </script>
</body>
</html>